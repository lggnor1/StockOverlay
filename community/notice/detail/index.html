<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공지사항 상세</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .notice-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }
        .notice-content {
            line-height: 1.6;
            margin-bottom: 20px;
            color: #666;
        }
        .notice-file {
            margin-top: 20px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
        }
        .notice-file a {
            color: #007bff;
            text-decoration: none;
        }
        .notice-file a:hover {
            text-decoration: underline;
        }
        .back-button {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }
        .back-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="noticeTitle" class="notice-title">로딩 중...</h1>
        <div id="noticeContent" class="notice-content"></div>
        <div id="noticeFile" class="notice-file" style="display: none;"></div>
        <a href="javascript:history.back()" class="back-button">← 목록으로 돌아가기</a>
    </div>

    <script type="module" src="https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/9.20.0/firebase-firestore.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB3ZgAsCO6zeNxOp2ivM2vttm80lYz-dIs",
            authDomain: "stockoverlay-1b03f.firebaseapp.com",
            projectId: "stockoverlay-1b03f",
            storageBucket: "stockoverlay-1b03f.firebasestorage.app",
            messagingSenderId: "429861010518",
            appId: "1:429861010518:web:951eeb87aaafb565668ff7",
            measurementId: "G-PDB3WTBNZF"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadNoticeDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');

            if (id) {
                try {
                    const noticeRef = doc(db, 'notices', id);
                    const docSnap = await getDoc(noticeRef);

                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        document.getElementById('noticeTitle').textContent = data.title || '제목 없음';
                        document.getElementById('noticeContent').innerHTML = data.content?.replace(/\n/g, '<br>') || '내용 없음';
                        
                        if (data.fileUrl) {
                            const fileDiv = document.getElementById('noticeFile');
                            const fileLink = document.createElement('a');
                            fileLink.href = data.fileUrl;
                            fileLink.textContent = '📎 첨부 파일 다운로드';
                            fileLink.target = '_blank';
                            fileDiv.appendChild(fileLink);
                            fileDiv.style.display = 'block';
                        }
                    } else {
                        document.getElementById('noticeTitle').textContent = "기록을 찾을 수 없습니다.";
                        document.getElementById('noticeContent').textContent = "";
                    }
                } catch (error) {
                    console.error('Error loading notice details: ', error);
                    document.getElementById('noticeTitle').textContent = "오류가 발생했습니다.";
                    document.getElementById('noticeContent').textContent = error.message;
                }
            } else {
                document.getElementById('noticeTitle').textContent = "잘못된 접근입니다.";
                document.getElementById('noticeContent').textContent = "ID가 제공되지 않았습니다.";
            }
        }

        document.addEventListener('DOMContentLoaded', loadNoticeDetails);
    </script>
</body>
</html>